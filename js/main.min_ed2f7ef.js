var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(a,s){function n(t){try{h(r.next(t))}catch(e){s(e)}}function o(t){try{h(r["throw"](t))}catch(e){s(e)}}function h(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(n,o)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(a)throw new TypeError("Generator is already executing.");for(;h;)try{if(a=1,s&&(n=s[2&i[0]?"return":i[0]?"throw":"next"])&&!(n=n.call(s,i[1])).done)return n;switch(s=0,n&&(i=[0,n.value]),i[0]){case 0:case 1:n=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,s=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(n=h.trys,!(n=n.length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){h.label=i[1];break}if(6===i[0]&&h.label<n[1]){h.label=n[1],n=i;break}if(n&&h.label<n[2]){h.label=n[2],h.ops.push(i);break}n[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],s=0}finally{a=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,s,n,o,h={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var a=RES.getRes(t);a?r(a):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.dumpstatus=1,e.statusreverse=!1,e.dumplock=!0,e.score=0,e.timer=new egret.Timer(1e3,0),e.timelimit=30,e.time=0,e.isGameOver=!1,e.isFirst=!0,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return[4,this.loadResource()];case 1:return i.sent(),this.createGameScene(),[4,RES.getResAsync("description_json")];case 2:return t=i.sent(),[4,platform.login()];case 3:return i.sent(),[4,platform.getUserInfo()];case 4:return e=i.sent(),console.log(e),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return i.sent(),this.stage.removeChild(t),[3,5];case 4:return e=i.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,i=this.stage.stageHeight;t.width=e,t.height=i;var r=this.createBitmapByName("logo_png");r.width=e,r.height=560,this.addChild(r);var a=new egret.TextField;this.addChild(a),a.alpha=0,a.width=e-172,a.textAlign=egret.HorizontalAlign.CENTER,a.size=24,a.textColor=16777215,a.x=172,a.y=135,this.textfield=a;var s=new eui.Button;s.label="即刻包水餃!",s.horizontalCenter=0,s.y=i/2+120,s.width=200,s.height=100,this.addChild(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onStartButtonClick,this);var n=new eui.Label;n.alpha=0,n.width=200,n.height=200,n.x=540,n.y=20,n.fontFamily="Tahoma",n.textColor=16776960,n.size=35,n.bold=!0,n.textAlign="middle",n.text="Score: "+this.score.toString(),this.addChild(n),this.scoretext=n;var o=new eui.Label;o.alpha=0,o.width=200,o.height=200,o.x=540,o.y=60,o.fontFamily="Tahoma",o.textColor=16776960,o.size=35,o.bold=!0,o.textAlign="middle",o.text="Timer: "+this.timelimit.toString(),this.addChild(o),this.timertext=o;var h=new eui.Label;h.alpha=0,h.width=200,h.height=150,h.x=345,h.y=600,h.fontFamily="Tahoma",h.textColor=15658496,h.size=80,h.bold=!0,h.textAlign="middle",h.text="3",this.addChild(h),this.readytext=h;var l=new eui.Label;l.alpha=0,l.width=450,l.height=200,l.x=155,l.y=400,l.fontFamily="Tahoma",l.textColor=15658496,l.size=35,l.bold=!0,l.textAlign="middle",l.text="按下R可以重新包餃子喔！",this.addChild(l),this.hinttext=l,this.PlayBGM("bgm_menu")},e.prototype.PlayGame=function(){var t,e=this,i=Math.floor(3*Math.random());switch(this.currentdump=i,this.timer.addEventListener(egret.TimerEvent.TIMER,this.Timer,this),this.time=this.timelimit,this.timer.start(),this.isFirst=!1,this.PlaySE("se_1"),this.PlayBGM("bgm_fight"),i){case 0:t=this.createBitmapByName("dump1-1");break;case 1:t=this.createBitmapByName("dump2-1");break;case 2:t=this.createBitmapByName("dump3-1")}t.x=this.stage.stageWidth/5+20,t.y=this.stage.stageHeight,t.alpha=0,this.dumpimage=t,this.addChild(t);var r=egret.Tween.get(t);r.to({alpha:1},100).to({y:this.stage.stageHeight/2},200).wait(10).call(function(){e.dumplock=!1}),this.kb=new KeyBoard,this.kb.addEventListener(KeyBoard.onkeydown,this.onKeyDown,this)},e.prototype.GameReady=function(){var t=this,e=this.readytext,i=3,r=function(){if(i>1){t.PlaySE("se_32");var a=egret.Tween.get(e);a.to({"ScaleX ":1.15,ScaleY:1.15},500).to({"ScaleX ":1,ScaleY:1},500).call(function(){i--,e.text=i.toString(),r()})}else if(1>=i){t.PlaySE("se_32");var a=egret.Tween.get(e);a.to({"ScaleX ":1.15,ScaleY:1.15},500).to({"ScaleX ":1,ScaleY:1},500).call(function(){e.alpha=0,t.isFirst?t.PlayGame():t.isFirst||t.GameRestart()})}};this.dumpimage&&(this.dumpimage.alpha=0),e.alpha=1,e.text=i.toString(),this.hinttext.alpha=0,this.timertext.text="Time: "+this.timelimit.toString(),this.scoretext.text="Score: 0",this.BGMChannel.stop(),r()},e.prototype.GameOver=function(){this.dumplock=!0,this.isGameOver=!0,this.hinttext.alpha=1},e.prototype.GameRestart=function(){this.score=0,this.time=this.timelimit,this.isGameOver=!1,this.scoretext.text="Score: "+this.score.toString(),this.timertext.text="Timer: "+this.time.toString(),this.hinttext.alpha=0,this.CreateDumpling(),this.timer.start(),this.PlaySE("se_1"),this.PlayBGM("bgm_fight")},e.prototype.Timer=function(){return this.time<=0?(this.timer.stop(),void this.GameOver()):(this.time--,void(this.timertext.text="Timer: "+this.time.toString()))},e.prototype.CreateDumpling=function(){var t=this,e=this.dumpimage,i=Math.floor(3*Math.random());switch(this.currentdump=i,i){case 0:e.texture=RES.getRes("dump1-1");break;case 1:e.texture=RES.getRes("dump2-1");break;case 2:e.texture=RES.getRes("dump3-1")}e.x=this.stage.stageWidth/5,e.y=this.stage.stageHeight,e.alpha=0,this.dumpimage=e;var r=egret.Tween.get(e);r.to({alpha:1},100).to({y:this.stage.stageHeight/2},200).wait(10).call(function(){t.dumplock=!1})},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.onStartButtonClick=function(t){var e=this.getChildAt(1),i=this.getChildAt(3),r=this.getChildAt(4),a=this.getChildAt(5),s=this.getChildAt(6);e.alpha=0,r.alpha=1,a.alpha=1,s.alpha=1,i.alpha=0,i.touchEnabled=!1,this.PlaySE("se_start"),this.GameReady()},e.prototype.onKeyDown=function(t){var e=this,i=this.currentdump,r=this.dumpstatus,a=this.dumpimage;if(this.kb.isContain(t.data,KeyBoard.R)&&this.isGameOver&&this.GameReady(),!this.isGameOver){if(this.kb.isContain(t.data,KeyBoard.UpArrow)&&!this.dumplock){0==i&&r>=3?(this.PlaySE("se_good"),this.score++):1==i&&r>=4?(this.PlaySE("se_good"),this.score++):2==i&&r>=5?(this.PlaySE("se_good"),this.score++):(this.SE=RES.getRes("se_bad"),this.SEChannel=this.SE.play(0,1)),this.scoretext.text="Score: "+this.score.toString(),r=1,this.statusreverse=!1,this.dumplock=!0;var s=egret.Tween.get(a);s.to({y:this.stage.stageHeight/6},200).to({alpha:0},100).call(function(){e.CreateDumpling()})}if((this.kb.isContain(t.data,KeyBoard.RightArrow)||this.kb.isContain(t.data,KeyBoard.keyArrow))&&!this.dumplock){switch(this.SE=RES.getRes("se_dump"),this.SEChannel=this.SE.play(0,1),this.statusreverse?this.statusreverse&&r--:r++,console.log(r),i){case 0:r>=3&&(this.statusreverse=!0),a.texture=RES.getRes("dump1-"+r.toString());break;case 1:r>=4&&(this.statusreverse=!0),a.texture=RES.getRes("dump2-"+r.toString());break;case 2:r>=5&&(this.statusreverse=!0),a.texture=RES.getRes("dump3-"+r.toString())}1>=r&&(this.statusreverse=!1)}}this.dumpstatus=r,this.dumpimage=a},e.prototype.PlayBGM=function(t){this.BGMChannel&&(this.BGMChannel.stop(),this.BGMChannel=null),this.BGM=RES.getRes(t),this.BGMChannel=this.BGM.play(),this.BGMChannel.volume=.6},e.prototype.PlaySE=function(t){this.SEChannel&&(this.SEChannel.stop(),this.SEChannel=null),this.SE=RES.getRes(t),this.SEChannel=this.SE.play(0,1),this.SEChannel.volume=1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function a(t){e.call(r,t)}function s(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),i.call(r))}var n=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},n)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(r,generateJSON.paths[t])},n)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(t,a,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);